"use strict";(self.webpackChunkslack_client=self.webpackChunkslack_client||[]).push([[94],{3094:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var r=n(7294),o=n(9369),l=(0,o.Z)("div",{target:"e53xsqb1"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),a=(0,o.Z)("header",{target:"e53xsqb0"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"}),i=n(6182),c=n.n(i),u=n(5591),s=n(3564),f=n(9250),d=n(2309),m=n(2545),p=n(8678),h=n(2861),v=n(8667),g=n(4593),y=n(2951);function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,a,i=[],c=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=l.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return i}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S=function(){var e,t,n,o=(0,f.UO)(),i=o.workspace,S=o.id,k=b((0,y.Z)(i),1)[0],Z=(0,u.ZP)("/api/workspaces/".concat(i,"/users/").concat(S),s.Z).data,E=(0,u.ZP)("/api/users",s.Z).data,A=b((0,p.Z)(""),3),C=A[0],I=A[1],T=A[2],j=(0,g.ZP)((function(e){return"/api/workspaces/".concat(i,"/dms/").concat(S,"/chats?perPage=20&page=").concat(e+1)}),s.Z),O=j.data,B=j.mutate,P=j.setSize,R=0===(null==O||null===(e=O[0])||void 0===e?void 0:e.length),_=R||O&&(null===(t=O[O.length-1])||void 0===t?void 0:t.length)<20||!1,q=(0,r.useRef)(null),z=(0,r.useCallback)((function(e){if(e.preventDefault(),null!=C&&C.trim()&&O){var t=C;B((function(e){var n;return null==e||e[0].unshift({id:((null===(n=O[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,SenderId:E.id,Sender:E,ReceiverId:Z.id,Receiver:Z,createdAt:new Date}),e}),!1).then((function(){var e;T(""),null===(e=q.current)||void 0===e||e.scrollToBottom()})),h.Z.post("/api/workspaces/".concat(i,"/dms/").concat(S,"/chats"),{content:C}).then((function(){var e;null===(e=q.current)||void 0===e||e.scrollToBottom()})).catch((function(e){console.log(e)}))}}),[C,i,O,E,Z,S,B,T]),D=(0,r.useCallback)((function(e){e.SenderId===Number(S)&&E.id!==Number(S)&&B((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){q.current&&q.current.getScrollHeight()<q.current.getClientHeight()+q.current.getScrollTop()+150&&setTimeout((function(){var e;null===(e=q.current)||void 0===e||e.scrollToBottom()}),50)}))}),[]);if((0,r.useEffect)((function(){return null==k||k.on("dm",D),function(){null==k||k.off("dm",D)}}),[k,D]),(0,r.useEffect)((function(){var e;1===(null==O?void 0:O.length)&&(null===(e=q.current)||void 0===e||e.scrollToBottom())}),[O]),!Z||!E)return null;var H,N=(0,v.Z)(O?(n=[]).concat.apply(n,(H=O,function(e){if(Array.isArray(e))return x(e)}(H)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(H)||w(H)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).reverse():[]);return r.createElement(l,null,r.createElement(a,null,r.createElement("img",{src:c().url(Z.email,{s:"24px",d:"retro"}),alt:Z.nickname}),r.createElement("span",null,Z.nickname)),r.createElement(m.Z,{chatSections:N,ref:q,setSize:P,isEmpty:R,isReachingEnd:_}),r.createElement(d.Z,{chat:C,onChangeChat:I,onSubmitForm:z}))}}}]);