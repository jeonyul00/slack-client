"use strict";(self.webpackChunkslack_client=self.webpackChunkslack_client||[]).push([[256],{5256:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var a=n(2309),r=n(2545),l=n(2219),o=n(8678),c=n(2951),i=n(9369),s=(0,i.Z)("div",{target:"e1edn30b2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),u=(0,i.Z)("header",{target:"e1edn30b1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),f=(0,i.Z)("div",{target:"e1edn30b0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"}),d=n(3564),p=n(8667),h=n(2861),m=n(7294),g=n(9250),v=n(5591),b=n(4593);function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,c=[],i=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=l.call(n)).done)&&(c.push(a.value),c.length!==t);i=!0);}catch(e){s=!0,r=e}finally{try{if(!i&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw r}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var k=function(){var e,t,n=(0,g.UO)(),i=n.workspace,y=n.channel,k=(0,v.ZP)("/api/users",d.Z).data,x=w((0,o.Z)(""),3),Z=x[0],C=x[1],E=x[2],_=(0,v.ZP)("/api/workspaces/".concat(i,"/channels/").concat(y),d.Z).data,T=(0,b.ZP)((function(e){return"/api/workspaces/".concat(i,"/channels/").concat(y,"/chats?perPage=20&page=").concat(e+1)}),d.Z),S=T.data,A=T.mutate,j=T.setSize,D=(0,v.ZP)(k?"/api/workspaces/".concat(i,"/channels/").concat(y,"/members"):null,d.Z).data,I=w((0,c.Z)(i),1)[0],O=0===(null==S||null===(e=S[0])||void 0===e?void 0:e.length),z=O||S&&(null===(t=S[S.length-1])||void 0===t?void 0:t.length)<20||!1,B=(0,m.useRef)(null),F=w((0,m.useState)(!1),2),P=F[0],U=F[1],M=w((0,m.useState)(!1),2),N=M[0],H=M[1],R=(0,m.useCallback)((function(e){if(e.preventDefault(),null!=Z&&Z.trim()&&S&&_){var t=Z;A((function(e){var n;return null==e||e[0].unshift({id:((null===(n=S[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:k.id,User:k,ChannelId:_.id,Channel:_,createdAt:new Date}),e}),!1).then((function(){var e;E(""),null===(e=B.current)||void 0===e||e.scrollToBottom()})),h.Z.post("/api/workspaces/".concat(i,"/channels/").concat(y,"/chats"),{content:Z}).catch(console.error)}}),[Z,S,k,_,i,y]),W=(0,m.useCallback)((function(e){e.Channel.name!==y||!e.content.startsWith("uploads\\")&&e.UserId===(null==k?void 0:k.id)||A((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){var e;B.current&&B.current.getScrollHeight()<B.current.getClientHeight()+B.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=B.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=B.current)||void 0===e||e.scrollToBottom()}),50))}))}),[y,k]);(0,m.useEffect)((function(){return null==I||I.on("message",W),function(){null==I||I.off("message",W)}}),[I,W]),(0,m.useEffect)((function(){1===(null==S?void 0:S.length)&&(console.log("toBottomWhenLoaded",B.current),setTimeout((function(){var e;console.log("scrollbar",B.current),null===(e=B.current)||void 0===e||e.scrollToBottom()}),500))}),[S]);var L=(0,m.useCallback)((function(){U(!0)}),[]),V=(0,m.useCallback)((function(){U(!1)}),[]),$=((0,m.useCallback)((function(e){var t=new FormData;if(e.target.files)for(var n=0;n<e.target.files.length;n++){var a=e.target.files[n].getAsFile();console.log("... file["+n+"].name = "+a.name),t.append("image",a)}h.Z.post("/api/workspaces/".concat(i,"/channels/").concat(y,"/images"),t).then((function(){}))}),[]),(0,m.useCallback)((function(e){e.preventDefault(),console.log(e);var t=new FormData;if(e.dataTransfer.items){for(var n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){var a=e.dataTransfer.items[n].getAsFile();t.append("image",a)}}else for(var r=0;r<e.dataTransfer.files.length;r++)console.log(e,"... file["+r+"].name = "+e.dataTransfer.files[r].name),t.append("image",e.dataTransfer.files[r]);h.Z.post("/api/workspaces/".concat(i,"/channels/").concat(y,"/images"),t).then((function(){H(!1)}))}),[i,y])),q=(0,m.useCallback)((function(e){e.preventDefault(),console.log(e),H(!0)}),[]);if(!k)return null;var G=(0,p.Z)(S?S.flat().reverse():[]);return m.createElement(s,{onDrop:$,onDragOver:q},m.createElement(u,null,m.createElement("span",null,"#",y),m.createElement("div",{className:"header-right"},m.createElement("span",null,null==D?void 0:D.length),m.createElement("button",{onClick:L,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(r.Z,{chatSections:G,ref:B,setSize:j,isReachingEnd:z,isEmpty:O}),m.createElement(a.Z,{chat:Z,onChangeChat:C,onSubmitForm:R}),m.createElement(l.Z,{show:P,onCloseModal:V,setShowInviteChannelModal:U}),N&&m.createElement(f,null,"업로드!"))}}}]);